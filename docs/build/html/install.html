

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation &mdash; CanDIG Federation Service 0.5.5 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Starting Federation" href="run.html" />
    <link rel="prev" title="Welcome to CanDIG Federation’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CanDIG Federation Service
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#main-py">__main__.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="#json-configs">JSON configs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uwsgi-configuration">uWSGI Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Starting Federation</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html#incoming-requests">Incoming Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html#request-flow">Request Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">candig_federation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Sending a Request</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html#why-no-get">Why No GET?</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing the Federation Service</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CanDIG Federation Service</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h1>
<p>After pulling the repo, create a virtual environment utilizing Python 3.7+ and install the requirements:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install -r requirements.txt
</pre></div>
</div>
<p>After installation, the federation service should first be configured.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<p>There are three sections which need to be configured to properly set up the federation service.</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> file in <code class="docutils literal notranslate"><span class="pre">federation_service/candig_federation</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">servers.json</span></code> and <code class="docutils literal notranslate"><span class="pre">services.json</span></code> files in <code class="docutils literal notranslate"><span class="pre">federation_service/configs</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">federation.ini</span></code> configuration file for uWSGI</p></li>
</ol>
<section id="main-py">
<h3>__main__.py<a class="headerlink" href="#main-py" title="Permalink to this heading">¶</a></h3>
<p>This file acts as the driver for the federation service as well as contains a number of default configuration settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--port&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">8890</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--host&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ga4ghdev01.bcgsc.ca&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--logfile&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;./log/federation.log&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--loglevel&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
                    <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;WARN&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">])</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--services&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;./configs/services.json&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--servers&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;./configs/servers.json&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--schemas&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;./configs/schemas.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Any of these keyword arguments may be altered when running the service through the command line. Additional arguments
may be added by copying the format above.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Argument</p></td>
<td><p>Explanation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--port</span></code></p></td>
<td><p>specifies the port the service should listen on.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--host</span></code></p></td>
<td><p>specifies the host address for the service.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--logfile</span></code></p></td>
<td><p>specifies the file which messages are logged to.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--loglevel</span></code></p></td>
<td><p>controls the verbosity of the logs.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--services</span></code></p></td>
<td><p>specifies a configuration file that tells Federation which services it should know about.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--servers</span></code></p></td>
<td><p>specifies a configuration file that tells Federation which peer servers it should know about.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="json-configs">
<h3>JSON configs<a class="headerlink" href="#json-configs" title="Permalink to this heading">¶</a></h3>
<p>Two types of configuration files are located in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder, <code class="docutils literal notranslate"><span class="pre">servers.json</span></code> and <code class="docutils literal notranslate"><span class="pre">services.json</span></code>, with examples for each marked by <code class="docutils literal notranslate"><span class="pre">_ex</span></code>.
Valid instances of both files are required in order to start the federation service.</p>
<p>Each peer server is listed in a <code class="docutils literal notranslate"><span class="pre">servers.json</span></code> configuration file should correspond with the Tyk API Gateway for each CanDIG node,
including this node where federation service is running. In addition, specify the location for your peer servers with
the array <code class="docutils literal notranslate"><span class="pre">[&quot;research</span> <span class="pre">centre&quot;,</span> <span class="pre">&quot;province</span> <span class="pre">name&quot;,</span> <span class="pre">&quot;province</span> <span class="pre">code&quot;]</span></code>. For compatibility with CanDIG’s <a class="reference external" href="https://github.com/CanDIG/candig-data-portal">data portal</a>,
use the following province codes: ‘ca-ab’, ‘ca-bc’, ‘ca-mb’, ‘ca-nb’, ‘ca-nl’, ‘ca-nt’, ‘ca-ns’, ‘ca-nu’, ‘ca-on’, ‘ca-pe’, ‘ca-qc’, ‘ca-sk’, ‘ca-yt’</p>
<p>For example, if your host federation service is running at <code class="docutils literal notranslate"><span class="pre">http://0.0.0.0:8890</span></code> in British Columbia, and your first
peer server federation service is running at <code class="docutils literal notranslate"><span class="pre">http://0.0.0.0:8891</span></code> in Ontario, your <code class="docutils literal notranslate"><span class="pre">servers.json`</span></code> would look like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;servers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://ga4ghdev01.bcgsc.ca:8891/federation/search&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;BCGSC&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;British Columbia&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;ca-bc&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://ga4ghdev01.bcgsc.ca:8892/federation/search&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;UHN&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;Ontario&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;ca-on&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://uwsgi-docs.readthedocs.io/en/latest/Configuration.html">https://uwsgi-docs.readthedocs.io/en/latest/Configuration.html</a>
In <code class="docutils literal notranslate"><span class="pre">services.json</span></code>, each service should correspond to a CanDIG service accessible by the federation service. Due to the way request parsing works,
it’s important to use the same service key name as its base API path.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;services&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="nt">&quot;katsu&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://example1.com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="nt">&quot;htsget&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://example2.com&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="uwsgi-configuration">
<h3>uWSGI Configuration<a class="headerlink" href="#uwsgi-configuration" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">federation.ini</span></code> file located in the top level of the directory controls uWSGI and should work as-is.
The <code class="docutils literal notranslate"><span class="pre">%d</span></code> special variable indicates the directory containing this configuration file. For more information
on how to customize the configuration, you should read the uwsgi <a class="reference external" href="https://uwsgi-docs.readthedocs.io/en/latest/Configuration.html">documentation</a>.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span><span class="w"></span>
<span class="na">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">wsgi:application</span><span class="w"></span>
<span class="na">chdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%d</span><span class="w"></span>

<span class="na">master</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
<span class="na">processes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span><span class="w"></span>

<span class="na">gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">candig</span><span class="w"></span>
<span class="na">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%d/federation.sock</span><span class="w"></span>
<span class="na">chmod-socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">660</span><span class="w"></span>
<span class="na">vacuum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>

<span class="na">die-on-term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="run.html" class="btn btn-neutral float-right" title="Starting Federation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to CanDIG Federation’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Dashaylan Naidoo, Javier Castillo-Arnemann

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>